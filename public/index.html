<!doctype html>
<html>
  <head>
    <title>Canvas Game</title>
    <style type="text/css">
    </style>
  </head>
  <body>
    <div id="canvasWrapper" style="border:1px solid; width:500px; height:300px;" tabindex="1" onclick="this.focus()">
		<canvas id="game" width="500px" height="300px">
			Could not create Canvas!
		</canvas>
	</div>
	<script type="text/javascript" src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.js"></script>
	<script type="text/javascript">
		var clientId = -10;
	
		var ws = new WebSocket('ws://localhost:3001');
		 
		ws.onopen = function (event) {
			//alert('Connection opened.');
		}

		$("#canvasWrapper").keydown(function(e) {
			var msg = {
				type: "keypressed",
				data: {id:clientId, key:e.which}
			};
			ws.send(JSON.stringify(msg));
		});
	  
		ws.onmessage = function (event) 
	    {
			var msg = JSON.parse(event);
			alert(msg.type);
			switch(msg.type) {
			case 0:
				var player = JSON.parse(msg.data);
				alert(player.clientId);
				clientId = player.clientId;
				var myCanvas = document.getElementById("game");
				var context = myCanvas.getContext("2d");
				alert(player.connected);
				if (!player.connected) {
					context.fillStyle = "white";
				} else {
					context.fillStyle = player.color;
				}
				context.fillRect(player.x, player.y, 10, 10);
			  break;
			case 1:
				var player = JSON.parse(msg.data);
				alert(player.clientId);
				var myCanvas = document.getElementById("game");
				var context = myCanvas.getContext("2d");
				alert(player.connected);
				if (!player.connected) {
					context.fillStyle = "white";
				} else {
					context.fillStyle = player.color;
				}
				context.fillRect(player.x, player.y, 10, 10);
			  break;
			case 2:
			  alert(msg.data);
			  break;
			}
		};
	</script>
  </body>
</html>