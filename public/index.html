<!doctype html>
<html>
  <head>
    <title>Canvas Game</title>
    <style type="text/css">
    </style>
  </head>
  <body>
    <div id="canvasWrapper" style="border:1px solid; width:500px; height:300px;" tabindex="1" onclick="this.focus()">
		<canvas id="game" width="500" height="300">
			Could not create Canvas!
		</canvas>
	</div>
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.js"></script>
	<script type="text/javascript">
		var clientId = 1;

		var ws = new WebSocket('ws://localhost:3001');

		ws.onopen = function (event) {
			//alert('Connection opened.');
		}

		$("#canvasWrapper").keydown(function(e) {
			var msg = {
				type: "keypressed",
				data: {id:clientId, key:e.which}
			};
			ws.send(JSON.stringify(msg));
		});

		ws.onmessage = function (event)
	    {
			var msg = JSON.parse(event.data);
			var type = parseInt(msg['type']);
			switch(type) {
			case 0:
      case 1:
        var player = msg['data'];

        clientId = player['clientId'];
        var myCanvas = document.getElementById("game");
				var context = myCanvas.getContext("2d");

				context.fillStyle = "white";
        context.fillRect(player['previous_x'], player['previous_y'], 10, 10);
				context.fillStyle = player['color'];
				/*if (!player['connected']) {
				} else {
				}*/
				context.fillRect(player['x'], player['y'], 10, 10);
			  break;
			case 2:
			  alert(msg['data']);
			  break;
			}
		};
	</script>
  </body>
</html>
